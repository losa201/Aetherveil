# Exploiter Agent Docker image
FROM aetherveil/base-agent:latest

# Install exploiter-specific tools
USER root
RUN apt-get update && apt-get install -y \
    metasploit-framework \
    sqlmap \
    hydra \
    john \
    hashcat \
    exploitdb \
    searchsploit \
    msfconsole \
    msfvenom \
    && rm -rf /var/lib/apt/lists/*

# Install additional Python packages for exploitation
RUN pip install --no-cache-dir \
    pwntools \
    paramiko \
    scapy \
    impacket \
    requests \
    beautifulsoup4 \
    cryptography \
    keystone-engine \
    capstone \
    unicorn

# Copy exploiter-specific configuration
COPY exploiter_config.json /app/config/

# Set environment variables
ENV AGENT_TYPE=exploiter
ENV AGENT_CAPABILITIES="exploit_execution,payload_generation,privilege_escalation,persistence_establishment,lateral_movement,backdoor_deployment,reverse_shell,buffer_overflow,sql_injection_exploit,web_shell_upload,service_exploitation"

# Security: Run in restricted environment
ENV AGENT_SANDBOX=true
ENV AGENT_NETWORK_ISOLATION=true

# Switch back to non-root user
USER agent

# Health check specific to exploiter agent
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
    CMD python -c "from agents.exploiter_agent import ExploiterAgent; print('Exploiter agent healthy')" || exit 1

# Run exploiter agent
CMD ["python", "-m", "agents.exploiter_agent", "${AGENT_ID:-exploiter-$(hostname)}"]